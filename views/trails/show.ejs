<%- include('../partials/header') %>
<h2>Trail Details</h2>
<section id="show-page">
    <div>Name: </div>
    <div><%= trail.name %></div>
    <div>Length (mile): </div>
    <div><%= trail.length %></div>
    <div>Elevation Gain (ft): </div>
    <div><%= trail.elevationGain %></div>
    <div>Difficulty: </div>
    <div><%= trail.difficulty %></div>
    <div>Route Type: </div>
    <div><%= trail.routeType %></div>
</section>

<% if (user) { %>
    <br><br>
    <h2>Reviews</h2>
    <form id="add-review-form" method="POST" action="/trails/<%= trail._id %>/reviews">
    <label>Review:
    <textarea name="content"></textarea>
    </label><br>
    <label>Rating:
    <select name="rating">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5" selected>5</option>
    </select>
    </label><br>
    <label>Activity Did:
    <select name="activity">
      <option value="Hiking" selected>Hiking</option>
      <option value="Running">Running</option>
      <option value="Biking">Biking</option>
      <option value="Backpacking">Backpacking</option>
      <option value="Snowshoeing">Snowshoeing</option>
      <option value="Horseback riding">Horseback riding</option>
    </select>
    </label><br>
    <input type="submit" value="Add Review">
  </form>
  <% } %>


    <% if (trail.reviews.length) { %>
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Date Submitted</th>
            <th>Review</th>
            <th>Rating</th>
            <th>Activity Did</th>
          </tr>
        </thead>
        <tbody>
          <% let total = 0 %>
          <% trail.reviews.forEach(function(r) { %>
            <% total += r.rating %>
            <tr>
              <td class="review-user"><%= r.userName %></td>
              <td><%= r.createdAt.toLocaleDateString() %></td>
              <td><%= r.content %></td>
              <td><%= r.rating %></td>
              <td><%= r.activityDid %></td>
              <td>
                <% if (user?._id.equals(r.user)) { %>
                  <form action="/reviews/<%= r._id %>?_method=DELETE" method="POST">
                    <button type="submit">X</button>
                  </form>
                <% } %>
              </td>
            </tr>
       
          <% }); %>
          <tr>
            <td colspan="3"></td>
            <td><strong><%= (total / trail.reviews.length).toFixed(1) %></strong></td>
          </tr>
 
        </tbody>
      </table>
      
      <% } else { %>
        <h5>No Reviews Yet</h5>
        <% } %>

<%- include('../partials/footer') %>